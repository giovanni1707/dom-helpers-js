<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Patterns - Conditions.js Demo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header class="demo-header">
      <h1>üöÄ Advanced Patterns</h1>
      <a href="index.html" class="back-button">‚Üê Back to Demos</a>
    </header>

    <section>
      <h2>Advanced Usage & Extensibility</h2>
      <p>Discover advanced patterns, custom matchers, extensibility features, and performance optimizations.</p>

      <!-- Custom Matchers -->
      <div class="interactive-demo">
        <h3>1. Custom Matchers</h3>
        <div class="demo-description">
          Extend Conditions.js by registering custom condition matchers for domain-specific logic.
        </div>
        
        <div class="demo-controls">
          <input type="text" id="custom-input" placeholder="Try: premium, basic, trial" value="premium">
          <button class="primary" onclick="testCustomMatcher()">Test Custom Matcher</button>
        </div>
        
        <div id="custom-output" class="demo-output">Enter a subscription type</div>
        
        <div class="code-display">
<span class="comment">// Register custom matcher</span>
Conditions.registerMatcher(<span class="string">'subscription'</span>, {
  test: <span class="keyword">(condition) =&gt;</span> condition === <span class="string">'isPremium'</span>,
  match: <span class="keyword">(value) =&gt;</span> [<span class="string">'premium'</span>, <span class="string">'pro'</span>, <span class="string">'enterprise'</span>].includes(value)
});

<span class="comment">// Use custom matcher</span>
Conditions.apply(subscriptionType, {
  <span class="string">'isPremium'</span>: { textContent: <span class="string">'‚ú® Premium Features Enabled'</span> }
});
        </div>
      </div>

      <!-- Custom Property Handlers -->
      <div class="interactive-demo">
        <h3>2. Custom Property Handlers</h3>
        <div class="demo-description">
          Create custom property handlers for specialized DOM operations.
        </div>
        
        <div class="demo-controls">
          <button class="primary" onclick="testCustomHandler()">Apply Custom Handler</button>
          <button class="secondary" onclick="resetCustomHandler()">Reset</button>
        </div>
        
        <div id="handler-output" class="demo-output">Click to test custom handler</div>
        
        <div class="code-display">
<span class="comment">// Register custom handler</span>
Conditions.registerHandler(<span class="string">'badge'</span>, {
  test: <span class="keyword">(key) =&gt;</span> key === <span class="string">'badge'</span>,
  apply: <span class="keyword">(element, config) =&gt;</span> {
    <span class="keyword">const</span> badge = document.createElement(<span class="string">'span'</span>);
    badge.textContent = config.text;
    badge.style.cssText = config.style;
    element.appendChild(badge);
  }
});

<span class="comment">// Use custom handler</span>
Conditions.apply(<span class="string">'active'</span>, {
  <span class="string">'active'</span>: { 
    badge: { text: <span class="string">'NEW'</span>, style: <span class="string">'...'</span> }
  }
});
        </div>
      </div>

      <!-- Batch Operations -->
      <div class="interactive-demo">
        <h3>3. Batch Operations</h3>
        <div class="demo-description">
          Use batch operations for better performance when updating multiple elements.
        </div>
        
        <div class="demo-controls">
          <button class="primary" onclick="batchUpdate()">Batch Update 100 Elements</button>
          <button class="secondary" onclick="clearBatch()">Clear</button>
        </div>
        
        <div id="batch-container" style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; margin-top: 15px; min-height: 100px;"></div>
        
        <div id="batch-time" class="demo-output">Ready to test</div>
        
        <div class="code-display">
<span class="comment">// Batch operations are more efficient</span>
Conditions.batch(<span class="keyword">() =&gt;</span> {
  elements.forEach(<span class="keyword">el =&gt;</span> {
    Conditions.apply(Math.random() > <span class="string">0.5</span> ? <span class="string">'active'</span> : <span class="string">'inactive'</span>, {
      <span class="string">'active'</span>: { style: { background: <span class="string">'green'</span> } },
      <span class="string">'inactive'</span>: { style: { background: <span class="string">'gray'</span> } }
    }, el);
  });
});
        </div>
      </div>

      <!-- Multiple Selectors -->
      <div class="interactive-demo">
        <h3>4. Multiple Element Selectors</h3>
        <div class="demo-description">
          Apply conditions to multiple elements at once using selectors or arrays.
        </div>
        
        <div class="demo-controls">
          <button class="primary" onclick="updateMultiple('success')">Set Success</button>
          <button class="error" onclick="updateMultiple('error')">Set Error</button>
          <button class="warning" onclick="updateMultiple('warning')">Set Warning</button>
        </div>
        
        <div class="grid-3" style="margin-top: 15px;">
          <div class="demo-output multi-target">Box 1</div>
          <div class="demo-output multi-target">Box 2</div>
          <div class="demo-output multi-target">Box 3</div>
        </div>
        
        <div class="code-display">
<span class="comment">// Apply to all matching elements</span>
Conditions.apply(status, {
  <span class="string">'success'</span>: { style: { background: <span class="string">'#4caf50'</span>, color: <span class="string">'white'</span> } }
}, <span class="string">'.multi-target'</span>);

<span class="comment">// Or use an array of elements</span>
Conditions.apply(status, conditions, [el1, el2, el3]);
        </div>
      </div>

      <!-- API Information -->
      <div class="interactive-demo">
        <h3>5. API Information</h3>
        <div class="demo-description">
          View available matchers, handlers, and library information.
        </div>
        
        <div class="demo-controls">
          <button class="primary" onclick="showAPI()">Show API Info</button>
        </div>
        
        <div id="api-output" class="demo-output">Click to view API information</div>
        
        <div class="code-display">
<span class="comment">// Get available matchers</span>
<span class="keyword">const</span> matchers = Conditions.getMatchers();

<span class="comment">// Get available handlers</span>
<span class="keyword">const</span> handlers = Conditions.getHandlers();

<span class="comment">// Check reactivity support</span>
<span class="keyword">const</span> hasReactivity = Conditions.hasReactivity;

<span class="comment">// Get current mode</span>
<span class="keyword">const</span> mode = Conditions.mode; <span class="comment">// 'reactive' or 'static'</span>
        </div>
      </div>

      <!-- Best Practices -->
      <div class="interactive-demo">
        <h3>6. Best Practices</h3>
        <div class="demo-description">
          Follow these patterns for optimal performance and maintainability.
        </div>
        
        <div class="code-display" style="line-height: 1.8;">
<span class="comment">// ‚úÖ DO: Use specific conditions first</span>
{
  <span class="string">'premium'</span>: { ... },
  <span class="string">'>100'</span>: { ... },
  <span class="string">'truthy'</span>: { ... }  <span class="comment">// fallback</span>
}

<span class="comment">// ‚úÖ DO: Combine related properties</span>
{
  <span class="string">'active'</span>: { 
    style: { color: <span class="string">'green'</span> },
    classList: [<span class="string">'active'</span>],
    setAttribute: { <span class="string">'aria-selected'</span>: <span class="string">'true'</span> }
  }
}

<span class="comment">// ‚úÖ DO: Use whenState for reactive data</span>
Conditions.whenState(<span class="keyword">() =&gt;</span> state.value, conditions, selector);

<span class="comment">// ‚úÖ DO: Batch multiple updates</span>
Conditions.batch(<span class="keyword">() =&gt;</span> {
  <span class="comment">// multiple operations here</span>
});

<span class="comment">// ‚ùå DON'T: Overuse generic matchers</span>
{ <span class="string">'truthy'</span>: { ... } } <span class="comment">// too broad, be specific</span>

<span class="comment">// ‚ùå DON'T: Mix static and reactive approaches</span>
<span class="comment">// Choose one approach and stick with it</span>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>
        <a href="03-reactive-state.html">‚Üê Reactive State</a> ‚Ä¢
        <a href="index.html">Back to Home</a>
      </p>
    </footer>
  </div>

  <script src="../dom-helpers.bundle.js"></script>
  <script src="../dom-helpers.reactive.bundle.js"></script>
  <script src="../conditions.js"></script>
  
  <script>
    // Custom Matcher Demo
    Conditions.registerMatcher('subscription', {
      test: (condition) => condition === 'isPremium',
      match: (value) => ['premium', 'pro', 'enterprise'].includes(value.toLowerCase())
    });
    
    function testCustomMatcher() {
      const value = document.getElementById('custom-input').value;
      
      Conditions.apply(value, {
        'isPremium': { 
          textContent: '‚ú® Premium Features Enabled', 
          style: { color: '#ff9800', background: '#fff8e1', border: '2px solid #ff9800', fontWeight: 'bold' } 
        },
        '"basic"': { 
          textContent: 'üì¶ Basic Subscription', 
          style: { color: '#2196f3', background: '#e3f2fd', border: '2px solid #2196f3' } 
        },
        '"trial"': { 
          textContent: 'üéÅ Trial Period', 
          style: { color: '#9c27b0', background: '#f3e5f5', border: '2px solid #9c27b0' } 
        },
        'truthy': { 
          textContent: `Unknown subscription: ${value}`, 
          style: { color: '#666', background: '#f5f5f5', border: '2px solid #ccc' } 
        }
      }, '#custom-output');
    }

    // Custom Handler Demo
    Conditions.registerHandler('badge', {
      test: (key) => key === 'badge',
      apply: (element, config) => {
        // Remove old badges
        element.querySelectorAll('.custom-badge').forEach(b => b.remove());
        
        // Add new badge
        const badge = document.createElement('span');
        badge.className = 'custom-badge';
        badge.textContent = config.text;
        badge.style.cssText = `
          background: ${config.color};
          color: white;
          padding: 4px 12px;
          border-radius: 12px;
          font-size: 0.8em;
          margin-left: 10px;
          font-weight: 600;
        `;
        element.appendChild(badge);
      }
    });
    
    function testCustomHandler() {
      Conditions.apply('active', {
        'active': { 
          textContent: 'Custom Handler Applied',
          badge: { text: 'NEW', color: '#4caf50' },
          style: { color: '#333', fontWeight: 'bold' }
        }
      }, '#handler-output');
    }
    
    function resetCustomHandler() {
      const el = document.getElementById('handler-output');
      el.textContent = 'Click to test custom handler';
      el.querySelectorAll('.custom-badge').forEach(b => b.remove());
      el.style.color = '';
      el.style.fontWeight = '';
    }

    // Batch Operations Demo
    function batchUpdate() {
      const container = document.getElementById('batch-container');
      container.innerHTML = '';
      
      // Create 100 elements
      const elements = [];
      for (let i = 0; i < 100; i++) {
        const el = document.createElement('div');
        el.style.cssText = 'width: 100%; height: 30px; border-radius: 4px;';
        container.appendChild(el);
        elements.push(el);
      }
      
      // Batch update
      const start = performance.now();
      
      Conditions.batch(() => {
        elements.forEach(el => {
          const status = Math.random() > 0.5 ? 'active' : 'inactive';
          Conditions.apply(status, {
            'active': { style: { background: '#4caf50' } },
            'inactive': { style: { background: '#e0e0e0' } }
          }, el);
        });
      });
      
      const duration = (performance.now() - start).toFixed(2);
      document.getElementById('batch-time').textContent = 
        `‚úì Updated 100 elements in ${duration}ms using batch operation`;
      document.getElementById('batch-time').style.color = '#4caf50';
    }
    
    function clearBatch() {
      document.getElementById('batch-container').innerHTML = '';
      document.getElementById('batch-time').textContent = 'Ready to test';
      document.getElementById('batch-time').style.color = '';
    }

    // Multiple Selectors Demo
    function updateMultiple(status) {
      Conditions.apply(status, {
        'success': { 
          textContent: '‚úì Success',
          style: { background: '#4caf50', color: 'white', border: '2px solid #4caf50' } 
        },
        'error': { 
          textContent: '‚úó Error',
          style: { background: '#f44336', color: 'white', border: '2px solid #f44336' } 
        },
        'warning': { 
          textContent: '‚ö† Warning',
          style: { background: '#ff9800', color: 'white', border: '2px solid #ff9800' } 
        }
      }, '.multi-target');
    }

    // API Information Demo
    function showAPI() {
      const matchers = Conditions.getMatchers();
      const handlers = Conditions.getHandlers();
      const hasReactivity = Conditions.hasReactivity;
      const mode = Conditions.mode;
      
      const info = `
        <strong>Library Mode:</strong> ${mode}<br>
        <strong>Reactivity Support:</strong> ${hasReactivity ? '‚úì Yes' : '‚úó No'}<br><br>
        <strong>Available Matchers (${matchers.length}):</strong><br>
        ${matchers.slice(0, 10).join(', ')}...<br><br>
        <strong>Available Handlers (${handlers.length}):</strong><br>
        ${handlers.slice(0, 10).join(', ')}...
      `;
      
      const output = document.getElementById('api-output');
      output.innerHTML = info;
      output.style.textAlign = 'left';
      output.style.lineHeight = '1.8';
      output.style.color = '#333';
    }

    // Initialize
    testCustomMatcher();
  </script>
</body>
</html>
