/**
 * DOM Helpers - Animation Module
 * Modular JavaScript Animations/Transitions helper that integrates seamlessly with DOM Helpers
 * 
 * Features:
 * - Declarative animation methods: fadeIn, fadeOut, slideUp, slideDown, slideToggle, transform
 * - Animation chaining support
 * - Configurable durations, delays, easing, and callbacks
 * - Compatible with .update({}) method from DOM Helpers
 * - Works with dynamic content (AJAX-loaded elements)
 * - Automatic cleanup of inline styles after animation completes
 * - Browser compatibility with graceful fallbacks
 * - Stays close to vanilla JavaScript using traditional DOM APIs
 * 
 * @version 1.0.0
 * @license MIT
 */
!function(e){"use strict";if(void 0===e.Elements&&"undefined"==typeof Elements)return void console.warn("[DOM Helpers Animation] Main DOM Helpers library must be loaded before the Animation module");const t={duration:300,delay:0,easing:"ease",cleanup:!0,queue:!0},n={linear:"linear",ease:"ease","ease-in":"ease-in","ease-out":"ease-out","ease-in-out":"ease-in-out","ease-in-quad":"cubic-bezier(0.55, 0.085, 0.68, 0.53)","ease-out-quad":"cubic-bezier(0.25, 0.46, 0.45, 0.94)","ease-in-out-quad":"cubic-bezier(0.455, 0.03, 0.515, 0.955)","ease-in-cubic":"cubic-bezier(0.55, 0.055, 0.675, 0.19)","ease-out-cubic":"cubic-bezier(0.215, 0.61, 0.355, 1)","ease-in-out-cubic":"cubic-bezier(0.645, 0.045, 0.355, 1)","ease-in-quart":"cubic-bezier(0.895, 0.03, 0.685, 0.22)","ease-out-quart":"cubic-bezier(0.165, 0.84, 0.44, 1)","ease-in-out-quart":"cubic-bezier(0.77, 0, 0.175, 1)","ease-in-quint":"cubic-bezier(0.755, 0.05, 0.855, 0.06)","ease-out-quint":"cubic-bezier(0.23, 1, 0.32, 1)","ease-in-out-quint":"cubic-bezier(0.86, 0, 0.07, 1)","ease-in-sine":"cubic-bezier(0.47, 0, 0.745, 0.715)","ease-out-sine":"cubic-bezier(0.39, 0.575, 0.565, 1)","ease-in-out-sine":"cubic-bezier(0.445, 0.05, 0.55, 0.95)","ease-in-expo":"cubic-bezier(0.95, 0.05, 0.795, 0.035)","ease-out-expo":"cubic-bezier(0.19, 1, 0.22, 1)","ease-in-out-expo":"cubic-bezier(1, 0, 0, 1)","ease-in-circ":"cubic-bezier(0.6, 0.04, 0.98, 0.335)","ease-out-circ":"cubic-bezier(0.075, 0.82, 0.165, 1)","ease-in-out-circ":"cubic-bezier(0.785, 0.135, 0.15, 0.86)","ease-in-back":"cubic-bezier(0.6, -0.28, 0.735, 0.045)","ease-out-back":"cubic-bezier(0.175, 0.885, 0.32, 1.275)","ease-in-out-back":"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},i={transitions:function(){const e=document.createElement("div"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(let n in t)if(void 0!==e.style[n])return{property:n,event:t[n]};return!1}(),transforms:function(){const e=document.createElement("div"),t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"];for(let n=0;n<t.length;n++)if(void 0!==e.style[t[n]])return t[n];return!1}()};const o=new class{constructor(){this.queues=new WeakMap}add(e,t){this.queues.has(e)||this.queues.set(e,[]),this.queues.get(e).push(t),1===this.queues.get(e).length&&this.process(e)}process(e){const t=this.queues.get(e);if(!t||0===t.length)return;(0,t[0])().then(()=>{t.shift(),t.length>0&&this.process(e)}).catch(()=>{t.shift(),t.length>0&&this.process(e)})}clear(e){this.queues.has(e)&&this.queues.set(e,[])}isEmpty(e){const t=this.queues.get(e);return!t||0===t.length}};function s(e={}){const i={...t,...e};return"string"==typeof i.easing&&n[i.easing]&&(i.easing=n[i.easing]),i}function r(e,t){return window.getComputedStyle(e).getPropertyValue(t)}function a(e,t){Object.entries(t).forEach(([t,n])=>{e.style[t]=n})}function c(e,t,n){const o=t.map(e=>`${e} ${n.duration}ms ${n.easing} ${n.delay}ms`).join(", ");i.transitions&&(e.style[i.transitions.property]=o)}function u(e,t){return new Promise(n=>{if(!i.transitions)return void setTimeout(n,t.duration+t.delay);let o=!1;const s=setTimeout(()=>{o||(o=!0,r(),n())},t.duration+t.delay+50),r=()=>{e.removeEventListener(i.transitions.event,a),clearTimeout(s)},a=t=>{t.target!==e||o||(o=!0,r(),n())};e.addEventListener(i.transitions.event,a)})}function l(e,t,n=[]){t.cleanup&&(i.transitions&&e.style.removeProperty(i.transitions.property),function(e,t){t.forEach(t=>{e.style.removeProperty(t)})}(e,n))}async function d(e,t={}){const n=s(t);return new Promise(async(t,i)=>{try{const i=r(e,"display");r(e,"opacity");"none"===i&&(e.style.display="block"),e.style.opacity="0",e.offsetHeight,c(e,["opacity"],n),e.style.opacity="1",await u(e,n),l(e,n,["opacity"]),"function"==typeof n.onComplete&&n.onComplete(e),t(e)}catch(e){i(e)}})}async function p(e,t={}){const n=s(t);return new Promise(async(t,i)=>{try{r(e,"opacity");c(e,["opacity"],n),e.style.opacity="0",await u(e,n),!1!==n.hide&&(e.style.display="none"),l(e,n,!1!==n.hide?["opacity"]:[]),"function"==typeof n.onComplete&&n.onComplete(e),t(e)}catch(e){i(e)}})}async function m(e,t={}){const n=s(t);return new Promise(async(t,i)=>{try{const i=e.offsetHeight,o=r(e,"padding-top"),s=r(e,"padding-bottom"),d=r(e,"margin-top"),p=r(e,"margin-bottom");r(e,"overflow");a(e,{height:i+"px",paddingTop:o,paddingBottom:s,marginTop:d,marginBottom:p,overflow:"hidden"}),e.offsetHeight,c(e,["height","padding-top","padding-bottom","margin-top","margin-bottom"],n),a(e,{height:"0px",paddingTop:"0px",paddingBottom:"0px",marginTop:"0px",marginBottom:"0px"}),await u(e,n),e.style.display="none",l(e,n,["height","padding-top","padding-bottom","margin-top","margin-bottom","overflow"]),"function"==typeof n.onComplete&&n.onComplete(e),t(e)}catch(e){i(e)}})}async function h(e,t={}){const n=s(t);return new Promise(async(t,i)=>{try{"none"===r(e,"display")&&(e.style.display="block");const i=e.offsetHeight,o=r(e,"padding-top"),s=r(e,"padding-bottom"),d=r(e,"margin-top"),p=r(e,"margin-bottom");a(e,{height:"0px",paddingTop:"0px",paddingBottom:"0px",marginTop:"0px",marginBottom:"0px",overflow:"hidden"}),e.offsetHeight,c(e,["height","padding-top","padding-bottom","margin-top","margin-bottom"],n),a(e,{height:i+"px",paddingTop:o,paddingBottom:s,marginTop:d,marginBottom:p}),await u(e,n),l(e,n,["height","padding-top","padding-bottom","margin-top","margin-bottom","overflow"]),"function"==typeof n.onComplete&&n.onComplete(e),t(e)}catch(e){i(e)}})}async function f(e,t={}){const n=s(t);return"none"!==r(e,"display")&&e.offsetHeight>0?m(e,n):h(e,n)}async function g(e,t,n={}){const o=s(n);return new Promise(async(n,s)=>{try{if(!i.transforms)return console.warn("[DOM Helpers Animation] Transform not supported in this browser"),void setTimeout(()=>n(e),o.duration+o.delay);let s="";Object.entries(t).forEach(([e,t])=>{switch(e){case"translateX":case"translateY":case"translateZ":case"scale":case"scaleX":case"scaleY":case"scaleZ":case"rotate":case"rotateX":case"rotateY":case"rotateZ":case"skew":case"skewX":case"skewY":s+=`${e}(${t}) `;break;case"translate":Array.isArray(t)?s+=`translate(${t[0]}, ${t[1]}) `:s+=`translate(${t}) `;break;case"translate3d":Array.isArray(t)&&t.length>=3&&(s+=`translate3d(${t[0]}, ${t[1]}, ${t[2]}) `);break;default:console.warn(`[DOM Helpers Animation] Unknown transform property: ${e}`)}}),c(e,[i.transforms],o),e.style[i.transforms]=s.trim(),await u(e,o),o.cleanup&&l(e,o,[i.transforms]),"function"==typeof o.onComplete&&o.onComplete(e),n(e)}catch(e){s(e)}})}class y{constructor(e){this.element=e,this.animations=[]}fadeIn(e={}){return this.animations.push(()=>d(this.element,e)),this}fadeOut(e={}){return this.animations.push(()=>p(this.element,e)),this}slideUp(e={}){return this.animations.push(()=>m(this.element,e)),this}slideDown(e={}){return this.animations.push(()=>h(this.element,e)),this}slideToggle(e={}){return this.animations.push(()=>f(this.element,e)),this}transform(e,t={}){return this.animations.push(()=>g(this.element,e,t)),this}delay(e){return this.animations.push(()=>new Promise(t=>setTimeout(t,e))),this}then(e){return this.animations.push(()=>"function"==typeof e?Promise.resolve(e(this.element)):Promise.resolve()),this}async play(){try{for(const e of this.animations)await e();return this.element}catch(e){throw console.error("[DOM Helpers Animation] Chain execution failed:",e),e}}}function b(e){return!e||e._hasAnimationMethods||(Object.defineProperty(e,"_hasAnimationMethods",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e.fadeIn=function(t={}){return s(t).queue&&!o.isEmpty(e)?new Promise(n=>{o.add(e,()=>d(e,t).then(n))}):d(e,t)},e.fadeOut=function(t={}){return s(t).queue&&!o.isEmpty(e)?new Promise(n=>{o.add(e,()=>p(e,t).then(n))}):p(e,t)},e.slideUp=function(t={}){return s(t).queue&&!o.isEmpty(e)?new Promise(n=>{o.add(e,()=>m(e,t).then(n))}):m(e,t)},e.slideDown=function(t={}){return s(t).queue&&!o.isEmpty(e)?new Promise(n=>{o.add(e,()=>h(e,t).then(n))}):h(e,t)},e.slideToggle=function(t={}){return s(t).queue&&!o.isEmpty(e)?new Promise(n=>{o.add(e,()=>f(e,t).then(n))}):f(e,t)},e.transform=function(t,n={}){return s(n).queue&&!o.isEmpty(e)?new Promise(i=>{o.add(e,()=>g(e,t,n).then(i))}):g(e,t,n)},e.animate=function(){return new y(e)},e.stopAnimations=function(){return o.clear(e),i.transitions&&e.style.removeProperty(i.transitions.property),e}),e}function w(e){if(!e||e._hasAnimationMethods)return e;function t(t,n={}){const i=e._originalCollection||e._originalNodeList||e,o=Array.from(i).map((e,i)=>{if(e&&e.nodeType===Node.ELEMENT_NODE){const o={...n};return n.stagger&&i>0&&(o.delay=(o.delay||0)+n.stagger*i),e._hasAnimationMethods||b(e),t(e,o)}return Promise.resolve()});return Promise.all(o).then(()=>e)}return Object.defineProperty(e,"_hasAnimationMethods",{value:!0,writable:!1,enumerable:!1,configurable:!1}),e.fadeIn=function(e={}){return t(d,e)},e.fadeOut=function(e={}){return t(p,e)},e.slideUp=function(e={}){return t(m,e)},e.slideDown=function(e={}){return t(h,e)},e.slideToggle=function(e={}){return t(f,e)},e.transform=function(e,n={}){return t((t,n)=>g(t,e,n),n)},e.stopAnimations=function(){const t=e._originalCollection||e._originalNodeList||e;return Array.from(t).forEach(e=>{e&&e.nodeType===Node.ELEMENT_NODE&&(o.clear(e),i.transitions&&e.style.removeProperty(i.transitions.property))}),e},e}function E(e,t=!1){return function(t={}){if(!t||"object"!=typeof t)return console.warn("[DOM Helpers Animation] .update() called with invalid updates object"),this;const n={...t},i=[];if(void 0!==n.fadeIn){const e=!0===n.fadeIn?{}:n.fadeIn;i.push(this.fadeIn(e)),delete n.fadeIn}if(void 0!==n.fadeOut){const e=!0===n.fadeOut?{}:n.fadeOut;i.push(this.fadeOut(e)),delete n.fadeOut}if(void 0!==n.slideUp){const e=!0===n.slideUp?{}:n.slideUp;i.push(this.slideUp(e)),delete n.slideUp}if(void 0!==n.slideDown){const e=!0===n.slideDown?{}:n.slideDown;i.push(this.slideDown(e)),delete n.slideDown}if(void 0!==n.slideToggle){const e=!0===n.slideToggle?{}:n.slideToggle;i.push(this.slideToggle(e)),delete n.slideToggle}if(void 0!==n.transform){const{transformations:e,options:t={}}=n.transform;e&&i.push(this.transform(e,t)),delete n.transform}n.stopAnimations&&(this.stopAnimations(),delete n.stopAnimations);let o=this;return Object.keys(n).length>0&&e&&(o=e.call(this,n)),i.length>0?Promise.all(i).then(()=>o):o}}const v={fadeIn:d,fadeOut:p,slideUp:m,slideDown:h,slideToggle:f,transform:g,setDefaults:function(e){return Object.assign(t,e),this},getDefaults:function(){return{...t}},isSupported:function(e){switch(e){case"transitions":return!!i.transitions;case"transforms":return!!i.transforms;default:return!1}},clearQueue:function(e){return o.clear(e),this},enhance:function(e){return e&&e.nodeType===Node.ELEMENT_NODE?b(e):e&&(void 0!==e.length||e._originalCollection||e._originalNodeList)?w(e):e},chain:function(e){return new y(e)},easing:n,version:"1.0.0"};void 0!==e.Elements||void 0!==e.Collections||void 0!==e.Selector?(!function(){if(e.Elements&&e.Elements.helper){const t=e.Elements.helper._enhanceElementWithUpdate;t&&(e.Elements.helper._enhanceElementWithUpdate=function(e){if((e=b(e=t.call(this,e))).update){const t=e.update;e.update=E(t,!1)}return e});const n=e.Elements;if(n&&"object"==typeof n)try{if(e.Elements.helper&&e.Elements.helper._getElement){const t=e.Elements.helper._getElement;e.Elements.helper._getElement=function(e){const n=t.call(this,e);return n&&n.nodeType===Node.ELEMENT_NODE&&!n._hasAnimationMethods?b(n):n}}}catch(e){console.warn("[DOM Helpers Animation] Could not enhance Elements proxy:",e.message)}}if(e.Collections&&e.Collections.helper){const t=e.Collections.helper._enhanceCollectionWithUpdate;t&&(e.Collections.helper._enhanceCollectionWithUpdate=function(e){if((e=w(e=t.call(this,e))).update){const t=e.update;e.update=E(t,!0)}return e})}if(e.Selector&&e.Selector.helper){const t=e.Selector.helper._enhanceElementWithUpdate;t&&(e.Selector.helper._enhanceElementWithUpdate=function(e){if((e=b(e=t.call(this,e))).update){const t=e.update;e.update=E(t,!1)}return e});const n=e.Selector.helper._enhanceCollectionWithUpdate;n&&(e.Selector.helper._enhanceCollectionWithUpdate=function(e){if((e=w(e=n.call(this,e))).update){const t=e.update;e.update=E(t,!0)}return e})}if(e.Forms&&e.Forms.helper){const t=e.Forms.helper._enhanceForm;t&&(e.Forms.helper._enhanceForm=function(e){if((e=b(e=t.call(this,e))).update){const t=e.update;e.update=E(t,!1)}return e})}}(),console.log("[DOM Helpers Animation] Animation module integrated successfully")):console.log("[DOM Helpers Animation] Animation module loaded in standalone mode"),"undefined"!=typeof module&&module.exports?module.exports={Animation:v}:"function"==typeof define&&define.amd?define([],function(){return{Animation:v}}):e.Animation=v,e.DOMHelpers&&(e.DOMHelpers.Animation=v)}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);