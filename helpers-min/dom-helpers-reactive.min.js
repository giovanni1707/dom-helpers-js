/**
 * DOM Helpers - Reactive State Extension
 * Smart reactivity system for declarative DOM updates
 * 
 * Features:
 * - Reactive state with Proxy (nested objects/arrays)
 * - Unified binding API across Elements, Collections, Selector
 * - Fine-grained updates with dependency tracking
 * - Automatic cleanup with WeakMap and MutationObserver
 * 
 * @version 1.0.0
 * @license MIT
 */
!function(e){"use strict";if(!e.Elements||!e.Collections||!e.Selector)return void console.error("[DOM Helpers Reactive] Core DOM Helpers library must be loaded first");const t=new WeakMap;let n=null;const o=new WeakMap,r=(new WeakMap,new WeakMap);function c(e,o=[],l=null){if(null===e||"object"!=typeof e)return e;if(t.has(e))return e;if(r.has(e))return r.get(e);const u=new Proxy(e,{get(e,l){n&&function(e,n,o){const r=t.get(e);if(!r)return;r.dependencies.has(n)||r.dependencies.set(n,new Set);r.dependencies.get(n).add(o)}(u,l,n);const f=e[l];if(Array.isArray(e)&&"function"==typeof f)return function(...n){const o=f.apply(e,n);if(["push","pop","shift","unshift","splice","sort","reverse"].includes(l)){i(u,"length");const e=t.get(u);e&&e.dependencies.size>0&&e.dependencies.forEach((e,t)=>{e.forEach(e=>{try{s(e)}catch(e){console.error("[DOM Helpers Reactive] Error executing binding:",e)}})})}return o};if(null!==f&&"object"==typeof f){if(!r.has(f)){const e=c(f,[...o,l],u);r.set(f,e)}return r.get(f)}return f},set(e,n,s){if(e[n]===s)return!0;if(null===s||"object"!=typeof s||t.has(s))e[n]=s;else{const t=c(s,[...o,n],u);r.set(s,t),e[n]=s}return i(u,n),!0},deleteProperty:(e,t)=>(t in e&&(delete e[t],i(u,t)),!0)});return t.set(u,{target:e,path:o,parent:l,dependencies:new Map}),r.set(e,u),u}function i(e,n){const o=t.get(e);if(!o)return;const r=o.dependencies.get(n);r&&r.forEach(e=>{try{s(e)}catch(e){console.error("[DOM Helpers Reactive] Error executing binding:",e)}})}function s(e){const{element:t,property:o,fn:r,lastValue:c}=e;if(!document.contains(t))return void f(e);const i=n;n=e;try{const n=r();if(u(n,c))return;e.lastValue=l(n),function(e,t,n){if(null==n)return void("textContent"===t&&(e.textContent=""));if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return void(t?"style"===t&&"string"==typeof n?e.style.cssText=n:t in e?e[t]=n:e.setAttribute(t,n):e.textContent=String(n));if(Array.isArray(n))return void(t?e[t]=n:e.textContent=n.join(", "));if(n instanceof Node)return void(t?console.warn("[DOM Helpers Reactive] Cannot assign DOM node to property:",t):(e.innerHTML="",e.appendChild(n)));"object"==typeof n&&(t?"style"===t?Object.entries(n).forEach(([t,n])=>{null!=n&&(e.style[t]=n)}):"dataset"===t?Object.entries(n).forEach(([t,n])=>{e.dataset[t]=n}):e[t]=n:Object.entries(n).forEach(([t,n])=>{"style"===t&&"object"==typeof n?Object.entries(n).forEach(([t,n])=>{null!=n&&(e.style[t]=n)}):"dataset"===t&&"object"==typeof n?Object.entries(n).forEach(([t,n])=>{e.dataset[t]=n}):t in e?e[t]=n:e.setAttribute(t,n)}))}(t,o,n)}finally{n=i}}function l(e){if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(e=>l(e));if(e instanceof Node)return e;const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=l(e[n]));return t}function u(e,t){if(e===t)return!0;if(null==e||null==t)return e===t;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every((e,n)=>u(e,t[n]));if(e instanceof Node||t instanceof Node)return e===t;const n=Object.keys(e),o=Object.keys(t);return n.length===o.length&&n.every(n=>u(e[n],t[n]))}return!1}function f(e){const{element:t}=e;o.has(t)&&o.get(t).delete(e)}function a(e,t,n){const r={element:e,property:t,fn:n,lastValue:void 0};return function(e){return o.has(e)||o.set(e,new Set),o.get(e)}(e).add(r),s(r),r}function d(e,t){"function"==typeof t?a(e,null,t):"object"==typeof t&&null!==t&&Object.entries(t).forEach(([t,n])=>{"function"==typeof n&&a(e,t,n)})}function y(e){document.querySelectorAll(e).forEach(e=>p(e))}function p(e){if(!o.has(e))return;o.get(e).forEach(e=>f(e)),o.delete(e)}const b=function(){const e=new MutationObserver(e=>{e.forEach(e=>{e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){p(e);e.querySelectorAll("*").forEach(e=>p(e))}})})});return document.body?e.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{e.observe(document.body,{childList:!0,subtree:!0})}),e}(),h={create:e=>c(e)};if(e.Elements&&(e.Elements.state=function(e){return c(e)},e.Elements.bind=function(e){Object.entries(e).forEach(([e,t])=>{const n=document.getElementById(e);n?d(n,t):console.warn(`[DOM Helpers Reactive] Element with id "${e}" not found`)})},e.Elements.unbind=function(e){const t=document.getElementById(e);t&&p(t)}),e.Collections&&(e.Collections.bind=function(e){Object.entries(e).forEach(([e,t])=>{const n=document.getElementsByClassName(e);Array.from(n).forEach(e=>{d(e,t)})})},e.Collections.unbind=function(e){const t=document.getElementsByClassName(e);Array.from(t).forEach(e=>p(e))}),e.Selector&&e.Selector.query){const t=e.Selector.query;t.bind=function(e){Object.entries(e).forEach(([e,t])=>{const n=document.querySelector(e);n?d(n,t):console.warn(`[DOM Helpers Reactive] No element found for selector "${e}"`)})},t.unbind=y}if(e.Selector&&e.Selector.queryAll){const t=e.Selector.queryAll;t.bind=function(e){Object.entries(e).forEach(([e,t])=>{document.querySelectorAll(e).forEach(e=>{d(e,t)})})},t.unbind=y}e.ReactiveState=h,"undefined"!=typeof window&&window.addEventListener("beforeunload",()=>{b&&b.disconnect()}),console.log("[DOM Helpers Reactive] Reactive state system loaded successfully")}("undefined"!=typeof window?window:"undefined"!=typeof global?global:this);