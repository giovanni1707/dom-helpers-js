<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Integrated Bulk Update Demo</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, sans-serif; 
      max-width: 900px; 
      margin: 50px auto; 
      padding: 20px; 
      background: #f5f5f5; 
    }
    .card { 
      background: white; 
      padding: 30px; 
      border-radius: 12px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
      margin-bottom: 20px; 
    }
    h1 { 
      color: #667eea; 
      margin-top: 0; 
    }
    h2 { 
      color: #667eea; 
      font-size: 18px; 
      border-bottom: 2px solid #667eea; 
      padding-bottom: 10px; 
    }
    button { 
      background: #667eea; 
      color: white; 
      border: none; 
      padding: 12px 24px; 
      border-radius: 6px; 
      cursor: pointer; 
      font-weight: 600; 
      margin: 5px; 
      transition: background 0.3s;
    }
    button:hover { 
      background: #5568d3; 
    }
    .result { 
      background: #f0f4ff; 
      padding: 15px; 
      margin: 15px 0; 
      border-radius: 6px; 
      border-left: 4px solid #667eea; 
    }
    .status { 
      padding: 8px 16px; 
      border-radius: 20px; 
      display: inline-block; 
      font-weight: 600; 
    }
    pre { 
      background: #263238; 
      color: #aed581; 
      padding: 15px; 
      border-radius: 6px; 
      font-size: 12px; 
      overflow-x: auto; 
      max-height: 300px;
      overflow-y: auto;
    }
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    .badge-success { background: #4caf50; color: white; }
    .badge-warning { background: #ff9800; color: white; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üöÄ Integrated Bulk Update Demo</h1>
    <p>Update state AND DOM elements in a single declarative call!</p>
  </div>

  <div class="card">
    <h2>1Ô∏è‚É£ Mixed State + DOM Updates (state.$update)</h2>
    <p>Update both state properties and DOM elements simultaneously</p>
    
    <button id="mixedUpdate">Update State + DOM</button>
    
    <div class="result">
      <strong>State Count:</strong> <span id="stateCount">0</span><br>
      <strong>State User:</strong> <span id="stateUser">John</span><br>
      <strong>Direct DOM:</strong> <span id="directDOM">Not updated</span>
    </div>
  </div>

  <div class="card">
    <h2>2Ô∏è‚É£ Functional Updates (state.$set)</h2>
    <p>Update state properties using functions for computed values</p>
    
    <button id="functionalUpdate">Increment with Functions</button>
    
    <div class="result">
      <strong>Counter:</strong> <span id="funcCounter">0</span><br>
      <strong>Doubled:</strong> <span id="funcDoubled">0</span><br>
      <strong>Message:</strong> <span id="funcMessage">Initial</span>
    </div>
  </div>

  <div class="card">
    <h2>3Ô∏è‚É£ Auto-Binding with createState()</h2>
    <p>Declarative bindings that automatically update DOM on state changes</p>
    
    <button id="autoUpdate">Update State (Auto-binds to DOM)</button>
    
    <div class="result">
      <strong>Counter:</strong> <span id="counter">0</span><br>
      <strong>User Name:</strong> <span id="userName">John</span><br>
      <strong>Full Info:</strong> <span id="fullInfo">John (30)</span><br>
      <strong>Status:</strong> <span class="status" id="status">Idle</span>
    </div>
  </div>

  <div class="card">
    <h2>4Ô∏è‚É£ Elements.updateAll() - Unified Updates</h2>
    <p>Update state and multiple DOM elements using different selectors</p>
    
    <button id="updateAllTypes">Update via updateAll()</button>
    
    <div class="result">
      <strong>Via ID Selector:</strong> <span id="viaElements">Not updated</span><br>
      <strong>Via Class Selector:</strong> <span class="viaCollections">Not updated</span><br>
      <strong>Via CSS Selector:</strong> <span data-type="selector">Not updated</span>
    </div>
  </div>

  <div class="card">
    <h2>5Ô∏è‚É£ Nested Property Updates</h2>
    <p>Update nested object properties using dot notation</p>
    
    <button id="nestedUpdate">Update Nested Properties</button>
    
    <div class="result">
      <strong>User Name:</strong> <span id="nestedName">-</span><br>
      <strong>User Age:</strong> <span id="nestedAge">-</span><br>
      <strong>User City:</strong> <span id="nestedCity">-</span>
    </div>
  </div>

  <div class="card">
    <h2>6Ô∏è‚É£ State.$bind() - Manual Bindings</h2>
    <p>Create reactive bindings manually after state creation</p>
    
    <button id="manualBindUpdate">Update with Manual Binding</button>
    
    <div class="result">
      <strong>Bound Value:</strong> <span id="boundValue">0</span><br>
      <strong>Computed Bound:</strong> <span id="computedBound">Even</span>
    </div>
  </div>

  <div class="card">
    <h2>üìä Update Log</h2>
    <pre id="log"></pre>
  </div>

  <!-- Load DOM Helpers libraries -->
  <script src="../../src/dom-helpers.js"></script>
  <script src="../../src/dom-helpers-reactive.js"></script>
  
  <script>
    function log(msg) {
      const logEl = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      logEl.textContent = `[${timestamp}] ${msg}\n${logEl.textContent}`;
      const lines = logEl.textContent.split('\n');
      if (lines.length > 20) {
        logEl.textContent = lines.slice(0, 20).join('\n');
      }
    }

    // ============================================
    // 1. Mixed State + DOM Updates
    // ============================================
    const mixedState = Elements.state({
      count: 0,
      user: {
        name: 'John',
        age: 30
      }
    });

    Elements.mixedUpdate.addEventListener('click', () => {
      log('üîÑ Starting mixed update...');
      
      mixedState.$update({
        // State updates
        count: mixedState.count + 1,
        'user.name': 'Bob',
        'user.age': 35,
        
        // DOM updates (using selectors)
        '#stateCount': { textContent: mixedState.count + 1 },
        '#stateUser': { textContent: 'Bob' },
        '#directDOM': { 
          textContent: 'Updated!', 
          style: { color: 'green', fontWeight: 'bold' }
        }
      });
      
      log(`‚úÖ Mixed update complete! Count: ${mixedState.count}, User: ${mixedState.user.name}`);
    });

    // ============================================
    // 2. Functional Updates (state.$set)
    // ============================================
    const funcState = Elements.state({
      counter: 0,
      doubled: 0,
      message: 'Initial'
    });

    Elements.functionalUpdate.addEventListener('click', () => {
      log('üîÑ Applying functional updates...');
      
      funcState.$set({
        counter: (prev) => prev + 1,
        doubled: (prev) => (funcState.counter + 1) * 2,
        message: (prev) => `Updated ${funcState.counter + 1} times`
      });

      // Update DOM manually to show the values
      Elements.funcCounter.textContent = funcState.counter;
      Elements.funcDoubled.textContent = funcState.doubled;
      Elements.funcMessage.textContent = funcState.message;
      
      log(`‚úÖ Functional update complete! Counter: ${funcState.counter}`);
    });

    // ============================================
    // 3. Auto-Binding (Declarative)
    // ============================================
    const autoState = Elements.createState(
      {
        counter: 0,
        user: {
          name: 'John',
          age: 30
        }
      },
      {
        // Declarative bindings - auto-update on state change
        '#counter': 'counter',
        '#userName': function() { return this.user.name; },
        '#fullInfo': function() { return `${this.user.name} (${this.user.age})`; },
        '#status': {
          textContent: function() { return this.counter > 5 ? 'High' : 'Low'; },
          style: function() {
            return {
              background: this.counter > 5 ? '#4caf50' : '#ff9800',
              color: 'white'
            };
          }
        }
      }
    );

    Elements.autoUpdate.addEventListener('click', () => {
      log('üîÑ Updating auto-bound state...');
      
      // Just update state - DOM updates automatically!
      autoState.$update({
        counter: autoState.counter + 2,
        'user.name': ['Alice', 'Bob', 'Charlie'][Math.floor(Math.random() * 3)],
        'user.age': autoState.user.age + 1
      });
      
      log(`‚úÖ Auto-binding updated! Counter: ${autoState.counter}, Name: ${autoState.user.name}`);
    });

    // ============================================
    // 4. Elements.updateAll() - Unified Updates
    // ============================================
    const allState = Elements.state({
      value: 0
    });

    Elements.updateAllTypes.addEventListener('click', () => {
      log('üîÑ Using updateAll() for unified updates...');
      
      allState.value++;
      
      // Update using different selector types
      Elements.updateAll(allState, {
        // State
        value: allState.value,
        
        // Elements (ID selector)
        '#viaElements': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#667eea', fontWeight: 'bold' }
        },
        
        // Collections (Class selector)
        '.viaCollections': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#4caf50', fontWeight: 'bold' }
        },
        
        // Selector (CSS selector)
        '[data-type="selector"]': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#ff9800', fontWeight: 'bold' }
        }
      });
      
      log(`‚úÖ updateAll() complete! Value: ${allState.value}`);
    });

    // ============================================
    // 5. Nested Property Updates
    // ============================================
    const nestedState = Elements.state({
      user: {
        name: 'Jane',
        age: 25,
        address: {
          city: 'New York'
        }
      }
    });

    Elements.nestedUpdate.addEventListener('click', () => {
      log('üîÑ Updating nested properties...');
      
      nestedState.$update({
        'user.name': 'Sarah',
        'user.age': nestedState.user.age + 1,
        'user.address.city': 'Los Angeles',
        
        '#nestedName': { textContent: 'Sarah' },
        '#nestedAge': { textContent: nestedState.user.age + 1 },
        '#nestedCity': { textContent: 'Los Angeles' }
      });
      
      log(`‚úÖ Nested update complete! User: ${nestedState.user.name}, City: ${nestedState.user.address.city}`);
    });

    // ============================================
    // 6. State.$bind() - Manual Bindings
    // ============================================
    const manualState = Elements.state({
      value: 0
    });

    // Create bindings after state creation
    manualState.$bind({
      '#boundValue': 'value',
      '#computedBound': function() {
        return this.value % 2 === 0 ? 'Even' : 'Odd';
      }
    });

    Elements.manualBindUpdate.addEventListener('click', () => {
      log('üîÑ Updating manually bound state...');
      
      manualState.value++;
      
      log(`‚úÖ Manual binding updated! Value: ${manualState.value}`);
    });

    // ============================================
    // Initial Log
    // ============================================
    log('‚úÖ Integrated Bulk Update Demo loaded successfully!');
    log('üí° Available features:');
    log('  - state.$update() - Mixed state + DOM updates');
    log('  - state.$set() - Functional updates');
    log('  - state.$bind() - Manual reactive bindings');
    log('  - Elements.createState() - State with auto-bindings');
    log('  - Elements.updateAll() - Unified updates');
    log('  - Nested property updates with dot notation');

    console.log('%c‚úÖ Demo Ready!', 'color: #4caf50; font-size: 16px; font-weight: bold;');
    console.log('%cNew Features:', 'color: #667eea; font-size: 14px; font-weight: bold;');
    console.log('‚Ä¢ state.$update() - Update state + DOM in one call');
    console.log('‚Ä¢ state.$set() - Functional updates');
    console.log('‚Ä¢ state.$bind() - Create reactive bindings');
    console.log('‚Ä¢ Elements.createState() - State with auto-bindings');
    console.log('‚Ä¢ Elements.updateAll() - Unified update method');
  </script>
</body>
</html>
