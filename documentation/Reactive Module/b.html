<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Integrated Bulk Update Demo</title>
  <style>
    body { font-family: system-ui; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
    .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    h1 { color: #667eea; margin-top: 0; }
    h2 { color: #667eea; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
    button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; margin: 5px; }
    button:hover { background: #5568d3; }
    .result { background: #f0f4ff; padding: 15px; margin: 15px 0; border-radius: 6px; border-left: 4px solid #667eea; }
    .status { padding: 8px 16px; border-radius: 20px; display: inline-block; font-weight: 600; }
    pre { background: #263238; color: #aed581; padding: 15px; border-radius: 6px; font-size: 12px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="card">
    <h1>üöÄ Integrated Bulk Update Demo</h1>
    <p>Update state AND DOM elements in a single declarative call!</p>
  </div>

  <div class="card">
    <h2>1Ô∏è‚É£ State + DOM Mixed Updates</h2>
    
    <button id="mixedUpdate">Update State + DOM</button>
    
    <div class="result">
      <strong>State Count:</strong> <span id="stateCount">0</span><br>
      <strong>State User:</strong> <span id="stateUser">John</span><br>
      <strong>Direct DOM:</strong> <span id="directDOM">Not updated</span>
    </div>
  </div>

  <div class="card">
    <h2>2Ô∏è‚É£ Auto-Binding (Declarative)</h2>
    
    <button id="autoUpdate">Update State (Auto-binds to DOM)</button>
    
    <div class="result">
      <strong>Counter:</strong> <span id="counter">0</span><br>
      <strong>User Name:</strong> <span id="userName">John</span><br>
      <strong>Full Info:</strong> <span id="fullInfo">John (30)</span><br>
      <strong>Status:</strong> <span class="status" id="status">Idle</span>
    </div>
  </div>

  <div class="card">
    <h2>3Ô∏è‚É£ Elements, Collections & Selector Updates</h2>
    
    <button id="updateAllTypes">Update via All Helpers</button>
    
    <div class="result">
      <strong>Via Elements (ID):</strong> <span id="viaElements">Not updated</span><br>
      <strong>Via Collections (Class):</strong> <span class="viaCollections">Not updated</span><br>
      <strong>Via Selector (CSS):</strong> <span data-type="selector">Not updated</span>
    </div>
  </div>

  <div class="card">
    <h2>üìä Update Log</h2>
    <pre id="log"></pre>
  </div>
<script src="dom-helpers-reactive.js"></script>
  <script src="../../src/dom-helpers.js"></script>
  
  <script>
    function log(msg) {
      const logEl = Elements.log;
      logEl.textContent = `${new Date().toLocaleTimeString()} - ${msg}\n${logEl.textContent}`;
      const lines = logEl.textContent.split('\n');
      if (lines.length > 15) {
        logEl.textContent = lines.slice(0, 15).join('\n');
      }
    }

    // ============================================
    // 1. Mixed State + DOM Updates
    // ============================================
    const mixedState = Elements.state({
      count: 0,
      user: {
        name: 'John',
        age: 30
      }
    });

    Elements.mixedUpdate.addEventListener('click', () => {
      log('üîÑ Starting mixed update...');
      
      // ‚ú® Update state AND DOM in one call!
      mixedState.$update({
        // State updates
        count: mixedState.count + 1,
        'user.name': 'Bob',
        'user.age': 35,
        
        // DOM updates
        '#stateCount': { textContent: mixedState.count + 1 },
        '#stateUser': { textContent: 'Bob' },
        '#directDOM': { 
          textContent: 'Updated!', 
          style: { color: 'green', fontWeight: 'bold' }
        }
      });
      
      log('‚úÖ Mixed update complete!');
    });

    // ============================================
    // 2. Auto-Binding (Declarative)
    // ============================================
    const autoState = Elements.createState(
      {
        counter: 0,
        user: {
          name: 'John',
          age: 30
        }
      },
      {
        // Declarative bindings - auto-update on state change
        '#counter': 'counter',
        '#userName': () => autoState.user.name,
        '#fullInfo': () => `${autoState.user.name} (${autoState.user.age})`,
        '#status': {
          textContent: () => autoState.counter > 5 ? 'High' : 'Low',
          style: () => ({
            background: autoState.counter > 5 ? '#4caf50' : '#ff9800',
            color: 'white'
          })
        }
      }
    );

    Elements.autoUpdate.addEventListener('click', () => {
      log('üîÑ Updating auto-bound state...');
      
      // Just update state - DOM updates automatically!
      autoState.$update({
        counter: autoState.counter + 2,
        'user.name': ['Alice', 'Bob', 'Charlie'][Math.floor(Math.random() * 3)],
        'user.age': autoState.user.age + 1
      });
      
      log(`‚úÖ State updated: counter=${autoState.counter}, name=${autoState.user.name}`);
    });

    // ============================================
    // 3. Elements, Collections & Selector Updates
    // ============================================
    const allState = Elements.state({
      value: 0
    });

    Elements.updateAllTypes.addEventListener('click', () => {
      log('üîÑ Updating via all helpers...');
      
      allState.value++;
      
      // Update using different selector types
      Elements.updateAll(allState, {
        // State
        value: allState.value,
        
        // Elements (ID selector)
        '#viaElements': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#667eea', fontWeight: 'bold' }
        },
        
        // Collections (Class selector)
        '.viaCollections': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#4caf50', fontWeight: 'bold' }
        },
        
        // Selector (CSS selector)
        '[data-type="selector"]': { 
          textContent: `Updated ${allState.value} times`,
          style: { color: '#ff9800', fontWeight: 'bold' }
        }
      });
      
      log('‚úÖ All helpers updated!');
    });

    console.log('‚úÖ Integrated Bulk Update Demo loaded!');
    console.log('üí° Features:');
    console.log('  - Mixed state + DOM updates');
    console.log('  - Auto-binding with createState()');
    console.log('  - Unified updateAll() for all helpers');
  </script>
</body>
</html>